import os
from app.game import BlackHoleGame
from flask.ext.login import login_required, current_user
from flask.ext.socketio import emit, send
from app import app, socketio
from binascii import hexlify

# map[id] = game

open_games = {}

running_games = {}

@login_required
@socketio.on('join')
def on_join(data):
    # Send userid back to user
    send({
        'user': current_user.id
    })

    # Look for player
    # LOCK : TODO
    for g in open_games:
        game = open_games[g]
        game.player2 = current_user
        running_games[g] = game
        del open_games[g]
        emit(game.to_json, room = game.room)
        break
    else:
        game = BlackHoleGame()
        game.player1 = current_user
        open_games[game.room] = game

@login_required
@socketio.on('leave')
def on_leave(data):
    username = data['username']
    room = data['room']
    leave_room(room)
    # send(username + ' has left the room.', room=room)
